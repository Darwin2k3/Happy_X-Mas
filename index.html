<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Christmas Gift</title>
<style>
html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: radial-gradient(circle at center, #021, #000);
}

/* =============== TẤM THIỆP THAY CHO HỘP QUÀ =============== */
.card {
    width: 320px;
    height: 200px;
    border: 6px solid gold;
    border-radius: 18px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.4);
    box-shadow: 0 0 25px gold;
    cursor: pointer;
    z-index: 10;

    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

/* Chữ bên trong thiệp */
.card-title {
    color: gold;
    font-size: 26px;
    font-weight: bold;
    text-shadow: 0 0 12px gold;
}

.card-small {
    color: white;
    font-size: 16px;
    margin-top: 6px;
    opacity: 0.8;
}

/* Nếu bạn muốn thêm hình chuông – style cho icon */
.card-icon {
    width: 150px;
    height: 100px;
    margin-bottom: 10px;
}
</style>
</head>
<body>

<!-- =============== TẤM THIỆP =============== -->
<div class="card" id="giftBox">

    <!-- hình trang trí (có thể thay đổi tùy thích) -->
    <img src="bell.png" class="card-icon" alt="bell">

    <div class="card-title">Merry Christmas</div>
    <div class="card-small">Click để mở thiệp</div>
</div>

<canvas id="canvas" style="display:none;"></canvas>
<audio id="music" loop src="music.mp3"></audio>

<script>
/* ======== PHẦN JS GIỮ NGUYÊN ======== */
const giftBox = document.getElementById("giftBox");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const audio = document.getElementById("music");

let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;
window.onresize = () => { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }

function rand(min,max){return Math.random()*(max-min)+min;}
class Snow{constructor(speed,size){this.reset(speed,size);} reset(speed,size){this.x=rand(0,W);this.y=rand(-H,0);this.speed=speed;this.size=size;} update(){this.y+=this.speed;if(this.y>H)this.reset(this.speed,this.size);} draw(){ctx.fillStyle="white";ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();}}
let snowflakes=[]; 
for(let i=0;i<120;i++) snowflakes.push(new Snow(1,2)); 
for(let i=0;i<120;i++) snowflakes.push(new Snow(2,3)); 
for(let i=0;i<100;i++) snowflakes.push(new Snow(3,4));

class Gift{
    constructor(x){
        this.x = x; this.y = -50;
        this.speed = 3; this.size = 50; this.active = true;
        this.color = ["red","yellow","green","cyan","magenta"][Math.floor(Math.random()*5)];
    }
    update(){ if(this.active){ this.y += this.speed; if(this.y>H-50) this.active=false; } }
    draw(){
        if(!this.active) return;
        ctx.save();
        ctx.translate(this.x,this.y);
        let glow = Math.sin(Date.now()/200 + this.x) * 0.5 + 0.5;
        ctx.lineJoin = "round";
        ctx.lineCap = "round";

        ctx.strokeStyle = `rgba(${getRGB(this.color)},${0.5+0.5*glow})`;
        ctx.lineWidth = 3 + glow*2;
        roundRect(ctx, -this.size/2, -this.size/2, this.size, this.size, 12, false, true);

        ctx.strokeStyle = `rgba(255,215,0,${0.5+0.5*glow})`;
        ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(-this.size/2,0); ctx.lineTo(this.size/2,0); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,-this.size/2); ctx.lineTo(0,this.size/2); ctx.stroke();

        let bowY = -this.size/2 - 12;
        ctx.fillStyle = "gold";
        ctx.beginPath(); ctx.ellipse(-this.size/4,bowY,this.size/6,this.size/6,-0.35,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(this.size/4,bowY,this.size/6,this.size/6,0.35,0,Math.PI*2); ctx.fill();
        ctx.fillStyle = "orange";
        ctx.beginPath(); ctx.arc(0,bowY,this.size/8,0,Math.PI*2); ctx.fill();

        ctx.restore();
    }
}

function roundRect(ctx, x, y, w, h, r, fill, stroke) {
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.lineTo(x+w-r, y);
    ctx.quadraticCurveTo(x+w, y, x+w, y+r);
    ctx.lineTo(x+w, y+h-r);
    ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
    ctx.lineTo(x+r, y+h);
    ctx.quadraticCurveTo(x, y+h, x, y+h-r);
    ctx.lineTo(x, y+r);
    ctx.quadraticCurveTo(x, y, x+r, y);
    ctx.closePath();
    if(fill) ctx.fill();
    if(stroke) ctx.stroke();
}

function getRGB(name){ 
    const colors = {
        red:"255,0,0",
        yellow:"255,255,0",
        green:"0,255,0",
        cyan:"0,255,255",
        magenta:"255,0,255"
    }; 
    return colors[name] || "255,255,255"; 
}

let gifts=[]; 
function dropGifts(){ 
    for(let i=0;i<5;i++) gifts.push(new Gift(rand(50,W-50))); 
}

class Firework{
    constructor(){this.x=rand(100,W-100);this.y=rand(50,250);this.timer=0;this.color=["red","yellow","cyan","magenta","orange","green"][Math.floor(rand(0,6))];}
    update(){this.timer++;}
    draw(){for(let i=0;i<20;i++){ let rx=this.x+rand(-this.timer*3,this.timer*3); let ry=this.y+rand(-this.timer*3,this.timer*3); ctx.fillStyle=this.color; ctx.fillRect(rx,ry,4,4);} }
    finished(){return this.timer>25;}
}
let fireworks=[];

let asciiTree=[
"        ^        ",
"       ***       ",
"      *****      ",
"     *******     ",
"    *********    ",
"      *****      ",
"   ***********   ",
"       | |       ",
"       | |       ",
"      -----      ",
];
let colors=["red","yellow","cyan","magenta","green"];
let COLOR={red:"#ff4040",yellow:"#ffff40",cyan:"#00ffff",magenta:"#ff40ff",green:"#40ff40"};

function drawASCII(){
    let y=H/2-80;
    for(let line of asciiTree){
        let x=W/2-90;
        for(let c of line){
            ctx.font="22px Consolas";
            if(c==="^"){ctx.fillStyle="yellow";ctx.font="26px Consolas";ctx.fillText("★",x,y);}
            else if(c==="*"){let col=colors[Math.floor(rand(0,colors.length))];ctx.fillStyle=COLOR[col];ctx.font="24px Consolas";ctx.fillText("*",x,y);}
            else{ctx.fillStyle="white";ctx.fillText(c,x,y);}
            x+=12;
        }
        y+=24;
    }
}

let giftTimer=0; let textShift=0;
function animate(){
    ctx.clearRect(0,0,W,H);

    let gradient = ctx.createLinearGradient(W/2-250,H/2-200,W/2+250,H/2-200);
    for(let i=0;i<colors.length;i++){ 
        let pos=((i/colors.length)+textShift)%1; 
        gradient.addColorStop(pos, colors[i]); 
    }
    ctx.font="40px Consolas"; 
    ctx.textAlign="center"; 
    ctx.fillStyle=gradient;
    ctx.fillText("MERRY CHRISTMAS BABE MY PHUNG",W/2,H/2-150);
    textShift+=0.01;

    snowflakes.forEach(s=>{s.update(); s.draw();});
    giftTimer++;
    if(giftTimer%100===0) dropGifts();
    gifts.forEach(g=>{g.update(); g.draw();});
    gifts = gifts.filter(g=>g.active);

    if(Math.random()<0.05) fireworks.push(new Firework());
    fireworks = fireworks.filter(fw=>{fw.update(); fw.draw(); return !fw.finished();});

    drawASCII();
    requestAnimationFrame(animate);
}

giftBox.addEventListener("click", ()=>{
    audio.currentTime=0; 
    audio.play().catch(e=>console.log(e));
    giftBox.style.display="none"; 
    canvas.style.display="block"; 
    animate();
});
canvas.addEventListener("click",()=>{if(audio.paused) audio.play().catch(e=>console.log(e));});
canvas.addEventListener("touchstart",()=>{if(audio.paused) audio.play().catch(e=>console.log(e));},{passive:true});
</script>
</body>
</html>
